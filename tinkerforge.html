<!--
  Copyright 2016 IBM Corp.
  Licensed under the Apache License, Version 2.0 (the "License");
  you may not use this file except in compliance with the License.
  You may obtain a copy of the License at
  http://www.apache.org/licenses/LICENSE-2.0
  Unless required by applicable law or agreed to in writing, software
  distributed under the License is distributed on an "AS IS" BASIS,
  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  See the License for the specific language governing permissions and
  limitations under the License.
-->
<script type="text/x-red" data-template-name="TinkerForgeConfig">
	<div class="form-row">
		<label for="node-config-input-host"><i class="fa "></i> Host</label>
		<input type="text" id="node-config-input-host" placeholder="127.0.0.1">
	</div>
	<div class="form-row">
		<label for="node-config-input-port"><i class="fa "></i> Port</label>
		<input type="text" id="node-config-input-port">
	</div>
	<div class="form-row">
		<label for="node-config-input-name"><i class="fa fa-tag"></i> Name</label>
		<input type="text" id="node-config-input-name">
	</div>
</script>

<script type="text/x-red" data-help-name="TinkerForgeConfig">
	<p>This node holds details of the instance of Tinkerforge's brickd to connect to</p>
	<p>This configuration node takes 3 arguments</p>
	<ul>
	  <li>Host - DNS name or IP address of the machine running <i>brickd</i></li>
	  <li>Port - Port number for <i>brickd</i> (default: 4223)</li>
	  <li>Name - Optional name for the connection</li>
	</ul>
</script>

<script type="text/javascript">
	RED.nodes.registerType("TinkerForgeConfig",{
		category: 'config',
		defaults: {
			host: {required: true},
			port: {value: 4223, required: true},
			name: {}
		},
		label: function() {
			return this.name || this.host + ":" + this.port;
		},
		oneditsave: function() {

			var host = $('#node-config-input-host').val();
			var port = $('#node-config-input-port').val();
			var dev = {
				id: this.id,
				host: host,
				port: port
			};
			$.post('TinkerForge/device',dev);
		}
	});
</script>

<script type="text/x-red" data-template-name="TinkerForge Motion">
	<div class="form-row">
        <label for="node-input-device"><i class="fa fa-tasks"></i> Device</label>
        <input type="text" id="node-input-device">
    </div>
    <div class="form-row">
    	<label for="node-input-sensor"><i class="fa"></i> Sensor</label>
    	<select id="node-input-sensor"></select>
    </div>
    <div class="form-row">
        <label for="node-input-topic"><i class="fa fa-tasks"></i> Topic</label>
        <input type="text" id="node-input-topic" placeholder="Topic">
    </div>
    <div class="form-row">
        <label for="node-input-name"><i class="fa fa-tag"></i> Name</label>
        <input type="text" id="node-input-name" placeholder="Humidity">
    </div>
</script>

<script type="text/x-red" data-help-name="TinkerForge Motion">
  <p>A node to trigger messages based on the TinkerForge Motion Bricklet</p>
  <p>The node takes a Tinkerforge device and a sensor as configuration parameters.</p>
  <p>The node outputs 2 messages</p>
  <ul>
    <li>payload: true - when movement is detected</li>
    <li>payload: fale - when no movement has been detected in the bricklets timeout period</li>
  </ul>
</script>

<script type="text/javascript">
	RED.nodes.registerType("TinkerForge Motion",{
		category: 'TinkerForge',
		defaults: {
			device: {type: "TinkerForgeConfig", required: true},
			sensor: {required: true},
			//sensor: {type: "TinkerForgeSensor", required: true},
			name: {},
			topic: {}
		},
		outputs: 1,
		inputs: 0,
		label: function() {
			return this.name || "TinkerForge Motion";
		},
		color: 'gray',
		icon: 'tf.png',
		oneditprepare: function() {
			var node = this;

			if (node.device) {
				var key = $('#node-input-device').val();
				$.getJSON('TinkerForge/' + key +"/sensors/" + 233, function(data){
					$('#node-input-sensor').find('option').remove().end();
					for (d in data) {
							$('<option/>',{
								value: data[d].uid,
								text: data[d].uid + " - " + data[d].typeName
							}).appendTo('#node-input-sensor');
						}
				});
			} else {
				console.log("no device");
			}

			$('#node-input-device').change(function(){
				var dev = $('#node-input-device').val();
				if (dev) {
					var key = dev;
					$.getJSON('TinkerForge/' + key +"/sensors/" + 233, function(data){
						$('#node-input-sensor').find('option').remove().end();
						for (d in data) {
							$('<option/>',{
								value: data[d].uid,
								text: data[d].uid + " - " + data[d].typeName
							}).appendTo('#node-input-sensor');
						}
					});
				} else {
					console.log("no device");
				}
			});

			if (node.sensor) {
				$('#node-input-sensor').val(node.sensor);
			}
		}
	});
</script>

<script type="text/x-red" data-template-name="TinkerForge Humidity">
	<div class="form-row">
        <label for="node-input-device"><i class="fa fa-tasks"></i> Device</label>
        <input type="text" id="node-input-device" >
    </div>
    <div class="form-row">
    	<label for="node-input-sensor"><i class="fa"></i> Sensor</label>
    	<select id="node-input-sensor"></select>
    </div>
    <div class="form-row">
        <label for="node-input-pollTime"><i class="fa fa-clock"></i> Poll Interval</label>
        <input type="number" id="node-input-pollTime" >
    </div>
    <div class="form-row">
        <label for="node-input-topic"><i class="fa fa-tasks"></i> Topic</label>
        <input type="text" id="node-input-topic" placeholder="Topic">
    </div>
    <div class="form-row">
        <label for="node-input-name"><i class="fa fa-tag"></i> Name</label>
        <input type="text" id="node-input-name" placeholder="Humidity">
    </div>
</script>

<script type="text/x-red" data-help-name="TinkerForge Humidity">
  <p>A node to trigger messages based on the TinkerForge Humidity Bricklet</p>
  <p>The node takes a Tinkerforge device, a sensor and a poll interval as configuration parameters.</p>
  <p>It outputs a message with relative humidity value as a value between 0 and 100 in the payload</p>
</script>

<script type="text/javascript">
	RED.nodes.registerType("TinkerForge Humidity",{
		category: 'TinkerForge',
		defaults: {
			device: {type: "TinkerForgeConfig", required: true},
			sensor: {required: true},
			pollTime: {value: "10", required: true},
			//sensor: {type: "TinkerForgeSensor", requried: true},
			name: {},
			topic: {}
		},
		outputs: 1,
		inputs: 0,
		label: function() {
			return this.name || "TinkerForge Humidity";
		},
		color: 'gray',
		icon: 'tf.png',
		oneditprepare: function() {
			var node = this;

			if (node.device) {
				var key = $('#node-input-device').val();
				$.getJSON('TinkerForge/' + key +"/sensors/" + 27, function(data){
					$('#node-input-sensor').find('option').remove().end();
					for (d in data) {
							$('<option/>',{
								value: data[d].uid,
								text: data[d].uid + " - " + data[d].typeName
							}).appendTo('#node-input-sensor');
						}
				});
			} else {
				console.log("no device");
			}

			$('#node-input-device').change(function(){
				var dev = $('#node-input-device').val();
				if (dev) {
					var key = dev;
					$.getJSON('TinkerForge/' + key +"/sensors/" + 27, function(data){
						$('#node-input-sensor').find('option').remove().end();
						for (d in data) {
							$('<option/>',{
								value: data[d].uid,
								text: data[d].uid + " - " + data[d].typeName
							}).appendTo('#node-input-sensor');
						}
					});
				} else {
					console.log("no device");
				}
			});

			if (node.sensor) {
				$('#node-input-sensor').val(node.sensor);
			}
		}
	});
</script>

<script type="text/x-red" data-template-name="TinkerForge PTC">
	<div class="form-row">
        <label for="node-input-device"><i class="fa fa-tasks"></i> Device</label>
        <input type="text" id="node-input-device" >
    </div>
    <div class="form-row">
    	<label for="node-input-sensor"><i class="fa"></i> Sensor</label>
    	<select id="node-input-sensor"></select>
    </div>
    <div class="form-row">
        <label for="node-input-pollTime"><i class="fa fa-clock"></i> Poll Interval</label>
        <input type="number" id="node-input-pollTime" >
    </div>
    <div class="form-row">
        <label for="node-input-topic"><i class="fa fa-tasks"></i> Topic</label>
        <input type="text" id="node-input-topic" placeholder="Topic">
    </div>
    <div class="form-row">
        <label for="node-input-name"><i class="fa fa-tag"></i> Name</label>
        <input type="text" id="node-input-name" placeholder="Temperature">
    </div>
</script>

<script type="text/x-red" data-help-name="TinkerForge PTC">
	<p>A input node to poll the value from a Tinkerforge PTC bricklet</p>
	<p>Configuration options are:</p>
	<ul>
		<li>Poll inteval - time between reteriving a new value</li>
	</ul>
	<p>Output:</p>
	<ul>
		<li>msg.payload - temperature in degrees C</li>
	</ul>
</script>

<script type="text/javascript">
	RED.nodes.registerType("TinkerForge PTC",{
		category: 'TinkerForge',
		defaults: {
			device: {type: "TinkerForgeConfig", required: true},
			sensor: {required: true},
			pollTime: {value: "10", required: true},
			//sensor: {type: "TinkerForgeSensor", requried: true},
			name: {},
			topic: {}
		},
		outputs: 1,
		inputs: 0,
		label: function() {
			return this.name || "TinkerForge PTC";
		},
		color: 'gray',
		icon: 'tf.png',
		oneditprepare: function() {
			var node = this;

			if (node.device) {
				var key = $('#node-input-device').val();
				$.getJSON('TinkerForge/' + key +"/sensors/" + 226, function(data){
					$('#node-input-sensor').find('option').remove().end();
					for (d in data) {
							$('<option/>',{
								value: data[d].uid,
								text: data[d].uid + " - " + data[d].typeName
							}).appendTo('#node-input-sensor');
						}
				});
			} else {
				console.log("no device");
			}

			$('#node-input-device').change(function(){
				var dev = $('#node-input-device').val();
				if (dev) {
					var key = dev;
					$.getJSON('TinkerForge/' + key +"/sensors/" + 226, function(data){
						$('#node-input-sensor').find('option').remove().end();
						for (d in data) {
							$('<option/>',{
								value: data[d].uid,
								text: data[d].uid + " - " + data[d].typeName
							}).appendTo('#node-input-sensor');
						}
					});
				} else {
					console.log("no device");
				}
			});

			if (node.sensor) {
				$('#node-input-sensor').val(node.sensor);
			}
		}
	});
</script>


<script type="text/x-red" data-template-name="TinkerForge Temperature">
	<div class="form-row">
        <label for="node-input-device"><i class="fa fa-tasks"></i> Device</label>
        <input type="text" id="node-input-device" >
    </div>
    <div class="form-row">
    	<label for="node-input-sensor"><i class="fa"></i> Sensor</label>
    	<select id="node-input-sensor"></select>
    </div>
    <div class="form-row">
        <label for="node-input-pollTime"><i class="fa fa-clock"></i> Poll Interval</label>
        <input type="number" id="node-input-pollTime" >
    </div>
    <div class="form-row">
        <label for="node-input-topic"><i class="fa fa-tasks"></i> Topic</label>
        <input type="text" id="node-input-topic" placeholder="Topic">
    </div>
    <div class="form-row">
        <label for="node-input-name"><i class="fa fa-tag"></i> Name</label>
        <input type="text" id="node-input-name" placeholder="Temperature">
    </div>
</script>

<script type="text/x-red" data-help-name="TinkerForge Temperature">
	<p>A input node to poll the value from a Tinkerforge Temperature bricklet</p>
	<p>Configuration options are:</p>
	<ul>
		<li>Poll inteval - time between reteriving a new value</li>
	</ul>
	<p>Output:</p>
	<ul>
		<li>msg.payload - temperature in degrees C</li>
	</ul>
</script>

<script type="text/javascript">
	RED.nodes.registerType("TinkerForge Temperature",{
		category: 'TinkerForge',
		defaults: {
			device: {type: "TinkerForgeConfig", required: true},
			sensor: {required: true},
			pollTime: {value: "10", required: true},
			//sensor: {type: "TinkerForgeSensor", requried: true},
			name: {},
			topic: {}
		},
		outputs: 1,
		inputs: 0,
		label: function() {
			return this.name || "TinkerForge Temperature";
		},
		color: 'gray',
		icon: 'tf.png',
		oneditprepare: function() {
			var node = this;

			if (node.device) {
				var key = $('#node-input-device').val();
				$.getJSON('TinkerForge/' + key +"/sensors/" + 216, function(data){
					$('#node-input-sensor').find('option').remove().end();
					for (d in data) {
							$('<option/>',{
								value: data[d].uid,
								text: data[d].uid + " - " + data[d].typeName
							}).appendTo('#node-input-sensor');
						}
				});
			} else {
				console.log("no device");
			}

			$('#node-input-device').change(function(){
				var dev = $('#node-input-device').val();
				if (dev) {
					var key = dev;
					$.getJSON('TinkerForge/' + key +"/sensors/" + 216, function(data){
						$('#node-input-sensor').find('option').remove().end();
						for (d in data) {
							$('<option/>',{
								value: data[d].uid,
								text: data[d].uid + " - " + data[d].typeName
							}).appendTo('#node-input-sensor');
						}
					});
				} else {
					console.log("no device");
				}
			});

			if (node.sensor) {
				$('#node-input-sensor').val(node.sensor);
			}
		}
	});
</script>

<script type="text/x-red" data-template-name="TinkerForge Digital-In">
	<div class="form-row">
        <label for="node-input-device"><i class="fa fa-tasks"></i> Device</label>
        <input type="text" id="node-input-device" >
    </div>
    <div class="form-row">
    	<label for="node-input-sensor"><i class="fa"></i> Sensor</label>
    	<select id="node-input-sensor"></select>
    </div>
    <div class="form-row">
        <label for="node-input-topic"><i class="fa fa-tasks"></i> Topic Prefix</label>
        <input type="text" id="node-input-topic" placeholder="Topic">
    </div>
    <div class="form-row">
        <label for="node-input-name"><i class="fa fa-tag"></i> Name</label>
        <input type="text" id="node-input-name" placeholder="Temperature">
    </div>
</script>

<script type="text/x-red" data-help-name="TinkerForge Digital-In">
</script>

<script type="text/javascript">
	RED.nodes.registerType("TinkerForge Digital-In",{
		category: 'TinkerForge',
		defaults: {
			device: {type: "TinkerForgeConfig", required: true},
			sensor: {required: true},
			//sensor: {type: "TinkerForgeSensor", requried: true},
			name: {},
			topic: {}
		},
		outputs: 1,
		inputs: 0,
		label: function() {
			return this.name || "TinkerForge Digital In 4";
		},
		color: 'gray',
		icon: 'tf.png',
		oneditprepare: function() {
			var node = this;

			if (node.device) {
				var key = $('#node-input-device').val();
				$.getJSON('TinkerForge/' + key +"/sensors/" + 223, function(data){
					$('#node-input-sensor').find('option').remove().end();
					for (d in data) {
							$('<option/>',{
								value: data[d].uid,
								text: data[d].uid + " - " + data[d].typeName
							}).appendTo('#node-input-sensor');
						}
				});
			} else {
				console.log("no device");
			}

			$('#node-input-device').change(function(){
				var dev = $('#node-input-device').val();
				if (dev) {
					var key = dev;
					$.getJSON('TinkerForge/' + key +"/sensors/" + 223, function(data){
						$('#node-input-sensor').find('option').remove().end();
						for (d in data) {
							$('<option/>',{
								value: data[d].uid,
								text: data[d].uid + " - " + data[d].typeName
							}).appendTo('#node-input-sensor');
						}
					});
				} else {
					console.log("no device");
				}
			});

			if (node.sensor) {
				$('#node-input-sensor').val(node.sensor);
			}
		}
	});
</script>

<script type="text/x-red" data-template-name="TinkerForge Digital-Out">
	<div class="form-row">
        <label for="node-input-device"><i class="fa fa-tasks"></i> Device</label>
        <input type="text" id="node-input-device" >
    </div>
    <div class="form-row">
    	<label for="node-input-sensor"><i class="fa"></i> Sensor</label>
    	<select id="node-input-sensor"></select>
    </div>
    <div class="form-row">
        <label for="node-input-name"><i class="fa fa-tag"></i> Name</label>
        <input type="text" id="node-input-name" placeholder="Temperature">
    </div>
</script>

<script type="text/x-red" data-help-name="TinkerForge Digital-Out">
	<p></p>
</script>

<script type="text/javascript">
	RED.nodes.registerType("TinkerForge Digital-Out",{
		category: 'TinkerForge',
		defaults: {
			device: {type: "TinkerForgeConfig", required: true},
			sensor: {required: true},
			//sensor: {type: "TinkerForgeSensor", requried: true},
			name: {}
		},
		outputs: 0,
		inputs: 1,
		label: function() {
			return this.name || "TinkerForge Digital Out 4";
		},
		color: 'gray',
		icon: 'tf.png',
		oneditprepare: function() {
			var node = this;

			if (node.device) {
				var key = $('#node-input-device').val();
				$.getJSON('TinkerForge/' + key +"/sensors/" + 224, function(data){
					$('#node-input-sensor').find('option').remove().end();
					for (d in data) {
							$('<option/>',{
								value: data[d].uid,
								text: data[d].uid + " - " + data[d].typeName
							}).appendTo('#node-input-sensor');
						}
				});
			} else {
				console.log("no device");
			}

			$('#node-input-device').change(function(){
				var dev = $('#node-input-device').val();
				if (dev) {
					var key = dev;
					$.getJSON('TinkerForge/' + key +"/sensors/" + 224, function(data){
						$('#node-input-sensor').find('option').remove().end();
						for (d in data) {
							$('<option/>',{
								value: data[d].uid,
								text: data[d].uid + " - " + data[d].typeName
							}).appendTo('#node-input-sensor');
						}
					});
				} else {
					console.log("no device");
				}
			});

			if (node.sensor) {
				$('#node-input-sensor').val(node.sensor);
			}
		}
	});
</script>

<script type="text/x-red" data-template-name="TinkerForge AmbientLight">
	<div class="form-row">
        <label for="node-input-device"><i class="fa fa-tasks"></i> Device</label>
        <input type="text" id="node-input-device" >
    </div>
    <div class="form-row">
    	<label for="node-input-sensor"><i class="fa"></i> Sensor</label>
    	<select id="node-input-sensor"></select>
    </div>
    <div class="form-row">
        <label for="node-input-pollTime"><i class="fa fa-clock"></i> Poll Interval</label>
        <input type="number" id="node-input-pollTime" >
    </div>
    <div class="form-row">
        <label for="node-input-topic"><i class="fa fa-tasks"></i> Topic</label>
        <input type="text" id="node-input-topic" placeholder="Topic">
    </div>
    <div class="form-row">
        <label for="node-input-name"><i class="fa fa-tag"></i> Name</label>
        <input type="text" id="node-input-name" placeholder="AmbientLight">
    </div>
</script>

<script type="text/x-red" data-help-name="TinkerForge AmbientLight">
	<p>A node to read the value from a Tinkerforge Ambient Light bricklet</p>
	<ul>
		<li>Pool time - time in seconds between reading current value</li>
	</ul>
</script>

<script type="text/javascript">
	RED.nodes.registerType("TinkerForge AmbientLight",{
		category: 'TinkerForge',
		defaults: {
			device: {type: "TinkerForgeConfig", required: true},
			sensor: {required: true},
			pollTime: {value: "10", required: true},
			//sensor: {type: "TinkerForgeSensor", requried: true},
			name: {},
			topic: {}
		},
		outputs: 1,
		inputs: 0,
		label: function() {
			return this.name || "TinkerForge AmbientLight";
		},
		color: 'gray',
		icon: 'tf.png',
		oneditprepare: function() {
			var node = this;

			if (node.device) {
				var key = $('#node-input-device').val();
				$.getJSON('TinkerForge/' + key +"/sensors/" + 259, function(data){
					$('#node-input-sensor').find('option').remove().end();
					for (d in data) {
							$('<option/>',{
								value: data[d].uid,
								text: data[d].uid + " - " + data[d].typeName
							}).appendTo('#node-input-sensor');
						}
				});
			} else {
				console.log("no device");
			}

			$('#node-input-device').change(function(){
				var dev = $('#node-input-device').val();
				if (dev) {
					var key = dev;
					$.getJSON('TinkerForge/' + key +"/sensors/" + 259, function(data){
						$('#node-input-sensor').find('option').remove().end();
						for (d in data) {
							$('<option/>',{
								value: data[d].uid,
								text: data[d].uid + " - " + data[d].typeName
							}).appendTo('#node-input-sensor');
						}
					});
				} else {
					console.log("no device");
				}
			});

			if (node.sensor) {
				$('#node-input-sensor').val(node.sensor);
			}
		}
	});
</script>


<script type="text/x-red" data-template-name="TinkerForge LEDStrip">
	<div class="form-row">
        <label for="node-input-device"><i class="fa fa-tasks"></i> Device</label>
        <input type="text" id="node-input-device" >
    </div>
    <div class="form-row">
    	<label for="node-input-sensor"><i class="fa"></i> Sensor</label>
    	<select id="node-input-sensor"></select>
    </div>
    <div class="form-row">
    	<label for="node-input-mode"><i class="fa fa-cogs"></i> Mode</label>
		<select id="node-input-mode" style="width:73%">
			<option value="pcent">Bar - Percent of length</option>
			<option value="pixels">Bar - Number of pixels</option>
			<option value="pcentneedle">Needle - Percent of length</option>
			<option value="pixelsneedle">Needle - Number of pixels</option>
			<option value="shiftu">Add pixel to start</option>
			<option value="shiftd">Add pixel to end</option>
		</select>
    </div>
    <div class="form-row">
    	<label for="node-input-rgb"><i class="fa"></i> RGB</label>
    	<select id="node-input-rgb" placeholder="rgb">
    		<option value="rgb">RGB</option>
    		<option value="brg">BRG</option>
    	</select>
    </div>
    <div class="form-row">
    	<label for="node-input-bgnd"><i class="fa"></i> Background</label>
    	<input type="text" id="node-input-bgnd" placeholder="0,0,0">
    </div>
    <div class="form-row">
    	<label for="node-input-pixels"><i class="fa"></i> Pixels</label>
    	<input type="text" id="node-input-pixels" >
    </div>
    <div class="form-row">
        <label for="node-input-name"><i class="fa fa-tag"></i> Name</label>
        <input type="text" id="node-input-name" placeholder="LED Strip">
    </div>
</script>

<script type="text/x-red" data-help-name="TinkerForge LEDStrip">
	<p>A node to control the LED strip bricklet. It is based on the neopixel node 
	and supports most of the same input input formats.</p>

	<p>It supports the following modes:</p>
	<ul>
		<li>Bar - percentage of length</li>
		<li>Bar - number of pixels</li>
		<li>Needle - percentage of length</li>
		<li>Needle - number of pixels</li>
	</ul>

	<p>Some LED strips take input values in RGB order and some in BRG, this node 
	always takes input in RGB order and there is a configuration option to set
	the order the stip requires.</p>

</script>

<script type="text/javascript">
	RED.nodes.registerType("TinkerForge LEDStrip",{
		category: 'TinkerForge',
		defaults: {
			device: {type: "TinkerForgeConfig", required: true},
			sensor: {required: true},
			pixels: {validate:RED.validators.number() , required: true},
			bgnd: {value: ""},
			rgb: {required: true, value:'rgb'},
			mode: {required: true},
			name: {}
		},
		outputs: 0,
		inputs: 1,
		label: function() {
			return this.name || "TinkerForge LEDStrip";
		},
		color: 'gray',
		icon: 'tf.png',
		oneditprepare: function() {
			var node = this;

			if (node.device) {
				var key = $('#node-input-device').val();
				$.getJSON('TinkerForge/' + key +"/sensors/" + 231, function(data){
					$('#node-input-sensor').find('option').remove().end();
					for (d in data) {
							$('<option/>',{
								value: data[d].uid,
								text: data[d].uid + " - " + data[d].typeName
							}).appendTo('#node-input-sensor');
						}
				});
			} else {
				console.log("no device");
			}

			$('#node-input-device').change(function(){
				var dev = $('#node-input-device').val();
				if (dev) {
					var key = dev;
					$.getJSON('TinkerForge/' + key +"/sensors/" + 231, function(data){
						$('#node-input-sensor').find('option').remove().end();
						for (d in data) {
							$('<option/>',{
								value: data[d].uid,
								text: data[d].uid + " - " + data[d].typeName
							}).appendTo('#node-input-sensor');
						}
					});
				} else {
					console.log("no device");
				}
			});

			if (node.sensor) {
				$('#node-input-sensor').val(node.sensor);
			}
		}
	});
</script>


<script type="text/x-red" data-template-name="TinkerForge AnalogOut">
	<div class="form-row">
        <label for="node-input-device"><i class="fa fa-tasks"></i> Device</label>
        <input type="text" id="node-input-device" >
    </div>
    <div class="form-row">
    	<label for="node-input-sensor"><i class="fa"></i> Sensor</label>
    	<select id="node-input-sensor"></select>
    </div>
    <div class="form-row">
        <label for="node-input-name"><i class="fa fa-tag"></i> Name</label>
        <input type="text" id="node-input-name" placeholder="LED Strip">
    </div>
</script>

<script type="text/x-red" data-help-name="TinkerForge AnalogOut">
	<p>A node to control the Tinkerforge Analog Out v2.0 bricklet</p>
	<p>The node takes a msg.payload value between 0 and 12 and this 
	sets the output voltage for the bricklet</p>
</script>

<script type="text/javascript">
	RED.nodes.registerType("TinkerForge AnalogOut",{
		category: 'TinkerForge',
		defaults: {
			device: {type: "TinkerForgeConfig", required: true},
			sensor: {required: true},
			name: {}
		},
		outputs: 0,
		inputs: 1,
		label: function() {
			return this.name || "TinkerForge Analog Out";
		},
		color: 'gray',
		icon: 'tf.png',
		oneditprepare: function() {
			var node = this;

			if (node.device) {
				var key = $('#node-input-device').val();
				$.getJSON('TinkerForge/' + key +"/sensors/" + 256, function(data){
					$('#node-input-sensor').find('option').remove().end();
					for (d in data) {
							$('<option/>',{
								value: data[d].uid,
								text: data[d].uid + " - " + data[d].typeName
							}).appendTo('#node-input-sensor');
						}
				});
			} else {
				console.log("no device");
			}

			$('#node-input-device').change(function(){
				var dev = $('#node-input-device').val();
				if (dev) {
					var key = dev;
					$.getJSON('TinkerForge/' + key +"/sensors/" + 256, function(data){
						$('#node-input-sensor').find('option').remove().end();
						for (d in data) {
							$('<option/>',{
								value: data[d].uid,
								text: data[d].uid + " - " + data[d].typeName
							}).appendTo('#node-input-sensor');
						}
					});
				} else {
					console.log("no device");
				}
			});

			if (node.sensor) {
				$('#node-input-sensor').val(node.sensor);
			}
		}
	});
</script>